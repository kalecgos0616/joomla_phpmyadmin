/*
* File: plugin.min.js (for MyJspUploader tinymce plugin)
* Author: Bernard saulmé
* Update: softs.saulme.fr 25/10/2013 (for Tinymce 4 & MyJspace >= 2.3.0)
* License: GNU/GPLv3 http://www.gnu.org/licenses/gpl-3.0.html
*/

tinymce.PluginManager.add("myjspuploader", function(e, url) {
	e.addCommand('mcemyjspuploader', function() {
		myjspuploader(null, url);
		}),
	e.addButton("myjspuploader",
		{
			title: 'Upload/delete file',
			image: url + '/img/myjspuploader.gif',
			cmd: 'mcemyjspuploader'
		}),
	e.addMenuItem("Tools",
		{
			text: 'Upload/delete file',
			context: 'file',
			onclick: function() {
				myjspuploader(null, url);
			}
		})
	}
);

function myjspuploader(field_name, url, type, win) {

	var param = tinymce.activeEditor.getParam('plugin_myjspuploader_param');
	strUploaderURL = param + '&type=' + type;
	
	tinymce.activeEditor.windowManager.open({
		file : strUploaderURL,
		title : 'Upload/delete file',
		buttons:{text:"Close",onclick:function(){this.parent().parent().close()}},
		width : 400,  
		height : 200,
		resizable : "no"
	}, {
		setUrl: function (url) { 
			if (typeof field_name !== "undefined")
				win.document.getElementById(field_name).value = url;
	}
	});

	return false;
}
